function buildChart(){d3.tsv("data/data.tsv",type,function(t,a){var e=d3.select(".app-chart-output").attr("width",function(t){return a.length*barSpace+400}).attr("height",height+100);y.domain([0,d3.max(a,function(t){return t.value})]);var r=e.selectAll("g").data(a).enter().append("g").attr("id",function(t,a){return"b"+a}).attr("class","bar").attr("transform",function(t,a){return"translate("+a*barSpace+",0)"}).attr("title",function(t){return t.title}).attr("artist",function(t){return t.artist}).attr("album",function(t){return t.album}).attr("plays",function(t){return t.value}).attr("dAdded",function(t){return t.dAdded}).attr("rank",function(t){return i});r.append("rect").attr("y",function(t){return y(t.value)}).attr("height",function(t){return height-y(t.value)}).attr("width",barWidth).attr("style",function(t,a){return"fill: url(#g-"+a+")"}),chartLabels=d3.select("#chart-labels"),$("#chart-labels").css("width",function(t){return a.length*barSpace+400}),$("#app-chart-output").on("mouseenter",".bar",function(){var t=$(this);id=t.attr("id"),title=t.attr("title"),pos=t.position(),posLeft=parseInt(pos.left)+100;var a=$('<div class="chart-label" id="label'+id+'" style="left: '+posLeft+'px">'+title+"</div>");a.appendTo(chartLabels)}),$("#app-chart-output").on("mouseleave",".bar",function(){chartLabels.html("")});var n=[];n=a.map(function(t){return t.artist}).sort();for(var n=n.reduce(function(t,a){return t.indexOf(a)<0&&t.push(a),t},[]),o=d3.select(".artistDropdown"),i=0;i<n.length;i++)o.append("option").attr("value",i).text(n[i]);var u=[];u=a.map(function(t){return t.album}).sort();for(var u=u.reduce(function(t,a){return t.indexOf(a)<0&&t.push(a),t},[]),s=d3.select(".albumDropdown"),i=0;i<u.length;i++)s.append("option").attr("value",i).text(u[i]);var l=[];l=a.map(function(t){return t.dAdded}),playsOrdered=a.map(function(t){return t.value});for(var i=0;i<l.length;i++){var c=Date.parse(l[i]);z=(c-14e11)/1e3/14734120*(playsOrdered[i]-8),l[i]=Math.floor(z),e.select("defs").append("linearGradient").attr("id","g-"+i).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",1).html(function(){var t='<stop class="stop'+i+'-2" offset="0%"/>',a='<stop class="stop'+i+'-1" offset="100%"/>';return t+a}),e.select("defs").append("style").attr("type","text/css").html(function(){var t=".stop"+i+"-1 { stop-color: rgb("+(60+l[i])+",24,225); stop-opacity: 1; }",a=".stop"+i+"-2 { stop-color: rgb("+(120+l[i])+", 42,84); stop-opacity: 1; }";return t+a})}})}function type(t){return t.value=+t.value,t}var height=450,width=9900,barWidth=40,unitWidth=140,barSpace=unitWidth-barWidth,y=d3.scale.linear().range([height,0]);$(document).ready(function(){function t(){s.show(),s.removeClass("bounceOutRight").addClass("bounceInRight")}function a(){l.show(),$("#close").show().removeClass("bouncOut").addClass("fadeIn"),l.removeClass("bounceOutRight").addClass("bounceInRight")}function e(){s.removeClass("bounceInRight").addClass("bounceOutRight"),window.setTimeout(function(){s.hide()},800)}function r(t){var a=t.attr("title"),e=t.attr("album"),r=t.attr("artist"),n=t.attr("plays");$("#modal-i-title").html(a),$("#modal-i-artist").html(r),$("#modal-i-album").html(e),$("#modal-i-plays").html(n+" Plays"),$("#footer-search").attr("href","https://www.google.ca/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q="+r+"%20-%20"+e),$("#footer-info").html(r+" - "+e)}function n(t){var a=t.attr("title"),e=t.attr("artist");query=a+" - "+e,o(query)}function o(t){gapi.client.setApiKey("AIzaSyCcoMFVU1juK4tpcn3OhQEb9QUO9rZVVFA"),gapi.client.load("youtube","v3",function(){i(t)})}function i(t){var a=t,e=gapi.client.youtube.search.list({q:a,part:"snippet",maxResults:1});e.execute(function(t){var a=t.result.items[0].id.videoId,e='<iframe width="300" height="169" src="https://www.youtube.com/embed/'+a+'?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>';l.html(e)})}$(".app-chart").mousewheel(function(t,a){this.scrollLeft-=30*a,t.preventDefault()});var u=$(".app-overlay"),s=$(".modal-info"),l=$("#modal-video-embed"),c=$("#close"),d;$("#app-chart-output").on("click",".bar",function(){var e=$(this);s.show(),r(e),n(e),t(),a()}),c.click(function(){s.addClass("bounceOutRight"),l.addClass("bounceOutRight"),c.removeClass("fadeIn").addClass("bounceOut"),window.setTimeout(e,800)}),$("#app-chart-output").on("mouseenter",".bar",function(){}),$("#app-chart-output").on("click",".bar",function(){$("#nux").addClass("animated bounceOutUp"),$(".nux-bg").addClass("animated fadeOut")}),$("#filter").hover(function(){$(this).css("opacity","1")},function(){$(this).css("opacity","0.4")}),$("#f-bar-w").on("keyup",function(){val=$(this).val(),barWidth=val}),$("#f-bar-s").on("keyup",function(){val=$(this).val(),barSpace=val}),$("#build").click(function(){return console.log("go"),buildChart(),!1})});