function addCommas(t){return(t+"").replace(/(\d)(?=(\d{3})+$)/g,"$1,")}var DEBUG=!1,ACTIVE_USER="iamnbutler",LAST_FM=new LastFM({apiKey:"eb5004312b5007e85399ab8128cd90ff",apiSecret:"9b23d8f9a695517052683f6b80fe655a",cache:new LastFMCache}),DATASET=[],ARTISTS=[],WIDTH=$("#scrobbles-graph").width(),HEIGHT=2*$("#scrobbles-graph").height(),PADDING=2;$(document).ready(function(){LAST_FM.library.getArtists({user:ACTIVE_USER,limit:30},{success:function(t){t.artists.artist.forEach(function(t){DEBUG&&console.log(t.name+" was played "+t.playcount+" times by "+ACTIVE_USER),DATASET.push(t.playcount),ARTISTS.push(t.name)}),console.log(t.artists),barchart(DATASET,ARTISTS,WIDTH,HEIGHT,PADDING)},error:function(t){}}),LAST_FM.user.getInfo({user:ACTIVE_USER},{success:function(t){$("#user").html(t.user.realname+"'s Profile");var r=t.user.playcount,e=addCommas(t.user.playcount);$("#u-scrobbles-graph-count").html(e)},error:function(t){}}),LAST_FM.user.getWeeklyChartList({user:ACTIVE_USER},{success:function(t){console.log(t.weeklychartlist)},error:function(t){}}),LAST_FM.artist.getInfo({artist:"Cher"},{success:function(t){console.log(artist)},error:function(t){}})}),barchart=function(t,r,e,n,a){var s=e||500,c=n||300,o=a||1,u=0;t.reverse().forEach(function(t){Number(u)<Number(t)&&(u=Number(t))});var i=d3.select("#scrobbles-graph").append("svg").attr("width",s).attr("height",c);i.selectAll("rect").data(t).enter().append("rect").attr("x",function(r,e){return e*(s/t.length)}).attr("y",function(t){return c-normalize(t,u,c/2)-c/2}).attr("width",s/t.length-o).attr("height",function(t){return normalize(t,u,c/2)}).attr("fill",function(t){return"rgb(255, 255, 255)"})},normalize=function(t,r,e){return Math.round(t*e/r)};