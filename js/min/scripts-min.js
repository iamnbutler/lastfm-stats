function type(t){return t.value=+t.value,t}var height=450,width=9900,barWidth=40,unitWidth=140,barSpace=unitWidth-barWidth,y=d3.scale.linear().range([height,0]);d3.tsv("data/data.tsv",type,function(t,e){var a=d3.select(".app-chart-output").attr("width",function(t){return e.length*barSpace+400}).attr("height",height+100);y.domain([0,d3.max(e,function(t){return t.value})]);var r=a.selectAll("g").data(e).enter().append("g").attr("id",function(t,e){return"b"+e}).attr("class","bar").attr("transform",function(t,e){return"translate("+e*barSpace+",0)"}).attr("title",function(t){return t.title}).attr("artist",function(t){return t.artist}).attr("album",function(t){return t.album}).attr("plays",function(t){return t.value}).attr("dAdded",function(t){return t.dAdded}).attr("rank",function(t){return n});r.append("rect").attr("y",function(t){return y(t.value)}).attr("height",function(t){return height-y(t.value)}).attr("width",barWidth).attr("style",function(t,e){return"fill: url(#g-"+e+")"}),chartLabels=d3.select("#chart-labels");for(var n=0;n<e.length;n++){var r=$("svg").find("#b"+n);chartLabels.html(function(){var t='<div class="chart-label" id="chart-label'+n+'"><p class="label-title"'+r.attr("title");return t})}var o=[];o=e.map(function(t){return t.artist}).sort();for(var o=o.reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[]),i=d3.select(".artistDropdown"),n=0;n<o.length;n++)i.append("option").attr("value",n).text(o[n]);var u=[];u=e.map(function(t){return t.album}).sort();for(var u=u.reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[]),l=d3.select(".albumDropdown"),n=0;n<u.length;n++)l.append("option").attr("value",n).text(u[n]);var s=[];s=e.map(function(t){return t.dAdded}),playsOrdered=e.map(function(t){return t.value});for(var n=0;n<s.length;n++){var c=Date.parse(s[n]);z=(c-14e11)/1e3/14734120*(playsOrdered[n]-8),s[n]=Math.floor(z),a.select("defs").append("linearGradient").attr("id","g-"+n).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",1).html(function(){var t='<stop class="stop'+n+'-2" offset="0%"/>',e='<stop class="stop'+n+'-1" offset="100%"/>';return t+e}),a.select("defs").append("style").attr("type","text/css").html(function(){var t=".stop"+n+"-1 { stop-color: rgb("+(60+s[n])+",24,225); stop-opacity: 1; }",e=".stop"+n+"-2 { stop-color: rgb("+(120+s[n])+", 42,84); stop-opacity: 1; }";return t+e})}}),$(document).ready(function(){function t(){l.show(),l.removeClass("bounceOutRight").addClass("bounceInRight")}function e(){s.show(),$("#close").show().removeClass("fadeOut").addClass("fadeIn"),s.removeClass("bounceOutRight").addClass("bounceInRight")}function a(){l.removeClass("bounceInRight").addClass("bounceOutRight"),window.setTimeout(function(){l.hide()},800)}function r(t){var e=t.attr("title"),a=t.attr("album"),r=t.attr("artist"),n=t.attr("plays");$("#modal-i-title").html(e),$("#modal-i-artist").html(r),$("#modal-i-album").html(a),$("#modal-i-plays").html(n+" Plays"),$("#footer-search").attr("href","https://www.google.ca/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q="+r+"%20-%20"+a),$("#footer-info").html(r+" - "+a)}function n(t){var e=t.attr("title"),a=t.attr("artist");query=e+" - "+a,o(query)}function o(t){gapi.client.setApiKey("AIzaSyCcoMFVU1juK4tpcn3OhQEb9QUO9rZVVFA"),gapi.client.load("youtube","v3",function(){i(t)})}function i(t){var e=t,a=gapi.client.youtube.search.list({q:e,part:"snippet",maxResults:1});a.execute(function(t){var e=t.result.items[0].id.videoId,a='<iframe width="300" height="169" src="https://www.youtube.com/embed/'+e+'?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>';s.html(a)})}$(".app-chart").mousewheel(function(t,e){this.scrollLeft-=30*e,t.preventDefault()});var u=$(".app-overlay"),l=$(".modal-info"),s=$("#modal-video-embed"),c=$("#close"),d;$("#app-chart-output").on("click",".bar",function(){var a=$(this);l.show(),r(a),n(a),t(),e()}),c.click(function(){l.addClass("bounceOutRight"),s.addClass("bounceOutRight"),c.removeClass("fadeIn").addClass("fadeOut"),window.setTimeout(a,800)}),$("#app-chart-output").on("mouseenter",".bar",function(){})});