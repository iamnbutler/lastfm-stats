function addCommas(r){return(r+"").replace(/(\d)(?=(\d{3})+$)/g,"$1,")}var DEBUG=!1,ACTIVE_USER="iamnbutler",LAST_FM=new LastFM({apiKey:"eb5004312b5007e85399ab8128cd90ff",apiSecret:"9b23d8f9a695517052683f6b80fe655a",cache:new LastFMCache}),DATASET=[],ARTISTS=[],WIDTH=$("#scrobbles-graph").width(),HEIGHT=2*$("#scrobbles-graph").height(),PADDING=2;$(document).ready(function(){LAST_FM.library.getArtists({user:ACTIVE_USER},{success:function(r){r.artists.artist.forEach(function(r){DEBUG&&console.log(r.name+" was played "+r.playcount+" times by "+ACTIVE_USER),DATASET.push(r.playcount),ARTISTS.push(r.name)}),barchart(DATASET,ARTISTS,WIDTH,HEIGHT,PADDING)},error:function(r){}}),LAST_FM.user.getInfo({user:ACTIVE_USER},{success:function(r){$("#user").html(r.user.realname+"'s Profile");var t=r.user.playcount,e=addCommas(r.user.playcount);$("#u-scrobbles-graph-count").html(e)},error:function(r){}}),LAST_FM.user.getWeeklyChartList({user:ACTIVE_USER},{success:function(r){console.log(r.weeklychartlist)},error:function(r){}})}),barchart=function(r,t,e,n,a){var c=e||500,u=n||300,s=a||1,o=0;r.forEach(function(r){Number(o)<Number(r)&&(o=Number(r))});var i=d3.select("#scrobbles-graph").append("svg").attr("width",c).attr("height",u);i.selectAll("rect").data(r).enter().append("rect").attr("x",function(t,e){return e*(c/r.length)}).attr("y",function(r){return u-normalize(r,o,u/2)-u/2}).attr("width",c/r.length-s).attr("height",function(r){return normalize(r,o,u/2)}).attr("fill",function(r){return"rgb(255, 255, 255)"})},normalize=function(r,t,e){return Math.round(r*e/t)};